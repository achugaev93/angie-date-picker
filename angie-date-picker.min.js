angular.module("angie.datePicker",[]).value("datePickerOptions",{modelDateFormat:"DD-MM-YYYY",viewDateFormat:"DD MMMM YYYY",header:!0,calendar:!0,time:!0,controls:!0,className:null,unitsMap:{years:"years",months:"months",weeks:"weeks",days:"days",hours:"hours",minutes:"minutes",seconds:"seconds",am:"hours"},steps:{years:1,months:1,weeks:1,days:1,am:12,hours:1,minutes:1,seconds:1},autoIncrement:{years:1,months:1,weeks:1,days:1,am:12,hours:1,minutes:10,seconds:10},autoIncrementInterval:250,position:"bl",spacing:1,template:'    <div class="ngldp" ng-class="{\'ngldp--inline\': isInline}">        <div class="ngldp__head" ng-show="showHeader">            <div class="ngldp__prev-month">                <button type="button"                        class="ngldp__btn ngldp__btn--prev"                        ng-keydown="isActivateKey($event) && prev(\'months\')"                         ng-click="prev(\'months\')">prev</button>            </div>            <div class="ngldp__current-month">{{ currentDate.format(\'MMMM\') }}</div>            <div class="ngldp__next-month">                <button type="button"                        class="ngldp__btn ngldp__btn--next"                        ng-keydown="isActivateKey($event) && next(\'months\')"                         ng-click="next(\'months\')">next</button>            </div>            <div class="ngldp__prev-year">                <button type="button"                        class="ngldp__btn ngldp__btn--prev"                        ng-keydown="isActivateKey($event) && prev(\'years\')"                         ng-click="prev(\'years\')">prev</button>            </div>            <div class="ngldp__current-year">{{ currentDate.format(\'YYYY\') }}</div>            <div class="ngldp__next-year">                <button type="button"                        class="ngldp__btn ngldp__btn--next"                        ng-keydown="isActivateKey($event) && next(\'years\')"                         ng-click="next(\'years\')">next</button>            </div>        </div>        <div class="ngldp__calendar-wrapper" ng-show="showCalendar">            <div class="ngldp__body">                <table class="ngldp__calendar">                    <thead class="ngldp__dows">                        <tr>                            <th class="ngldp__dow"                                ng-repeat="day in daysNames"                                ng-class="{\'ngldp__day--weekend\': day.weekend}">{{ day.name }}</th>                        </tr>                    </thead>                    <tbody>                        <tr class="ngldp__week" ng-repeat="week in weeks">                            <td class="ngldp__day"                                 tabindex="{{ day.inactive ? \'\' : 0 }}"                                ng-repeat="day in week"                                ng-click="selectDay(day)"                                ng-keydown="isActivateKey($event) && selectDay(day)"                                ng-class="{\'ngldp__day--inactive\': day.inactive, \'ngldp__day--today\': day.today, \'ngldp__day--selected\': currentDate.date() == day.number && !day.inactive, \'ngldp__day--weekend\': day.weekend}">                                {{ day.number }}                            </td>                        </tr>                    </tbody>                </table>            </div>        </div>        <div class="ngldp__time-wrapper" ng-show="showTime">            <div class="ngldp__body">                <table class="ngldp__time">                    <tr>                        <td><button type="button"                                     class="ngldp__btn ngldp__up-btn"                                     ng-mousedown="add(steps.hours, \'hours\'); startAutoIncrement(\'hours\')"                                     ng-keydown="isActivateKey($event) && add(steps.hours, \'hours\')"                                     ng-click="endAutoIncrement()"                                     ng-mouseleave="endAutoIncrement()">add hour</button>                        </td>                        <td> </td>                        <td><button type="button"                                    class="ngldp__btn ngldp__up-btn"                                    ng-mousedown="add(steps.minutes, \'minutes\'); startAutoIncrement(\'minutes\')"                                    ng-keydown="isActivateKey($event) && add(steps.minutes, \'minutes\')"                                     ng-click="endAutoIncrement()"                                    ng-mouseleave="endAutoIncrement()">add minute</button>                        </td>                        <td><button type="button"                                    class="ngldp__btn ngldp__up-btn"                                    ng-mousedown="add(steps.am, \'hours\'); startAutoIncrement(\'am\')"                                    ng-keydown="isActivateKey($event) && add(steps.am, \'hours\')"                                     ng-click="endAutoIncrement()"                                    ng-mouseleave="endAutoIncrement()">add half a day</button>                        </td>                    </tr>                    <tr>                        <td><div class="ngldp__time-box">{{ currentDate.format(\'hh\') }}</div></td>                        <td> : </td>                        <td><div class="ngldp__time-box">{{ currentDate.format(\'mm\') }}</div></td>                        <td>{{ currentDate.format(\'A\') }}</td>                    </tr>                    <tr>                        <td><button type="button"                                     class="ngldp__btn ngldp__down-btn"                                    ng-mousedown="subtract(steps.hours, \'hours\'); startAutoDecrement(\'hours\')"                                    ng-keydown="isActivateKey($event) && subtract(steps.hours, \'hours\')"                                     ng-click="endAutoIncrement()"                                    ng-mouseleave="endAutoIncrement()">subtract hour</button>                        </td>                        <td> </td>                        <td><button type="button"                                    class="ngldp__btn ngldp__down-btn"                                    ng-mousedown="subtract(steps.minutes, \'minutes\'); startAutoDecrement(\'minutes\')"                                    ng-keydown="isActivateKey($event) && subtract(steps.minutes, \'minutes\')"                                     ng-click="endAutoIncrement()"                                    ng-mouseleave="endAutoIncrement()">subtract minute</button>                         </td>                        <td><button type="button"                                    class="ngldp__btn ngldp__down-btn"                                    ng-mousedown="subtract(steps.am, \'hours\'); startAutoDecrement(\'am\')"                                    ng-keydown="isActivateKey($event) && subtract(steps.am, \'hours\')"                                     ng-click="endAutoIncrement()"                                    ng-mouseleave="endAutoIncrement()">subtract half a day</button>                        </td>                    </tr>                </table>            </div>        </div>        <div class="ngldp__controls" ng-show="showControls && (showCalendar || !isInline)">            <button type="button"                    class="ngldp__btn ngldp__btn--today"                    ng-show="showCalendar"                    ng-click="selectToday()">Today</button>            <button type="button"                    class="ngldp__btn ngldp__btn--ok"                    ng-hide="isInline"                    ng-click="close()">Ok</button>        </div>    </div>    '}).directive("datePicker",["$compile","$interval","datePickerOptions",function(e,t,n){var a=angular.element(document.body);return{restrict:"EA",require:"ngModel",scope:{model:"=ngModel",datePicker:"=",options:"="},link:function(s,o,r,d){function c(e,t){var n=moment(e);n.date(t);var a=n.day();return 0===a||6===a}function u(e,t){var n=moment(),a=moment(e);return a.date(t),a.isSame(n,"day")}function i(){var e={},t=o[0].getBoundingClientRect(),n=y[0].getBoundingClientRect(),a=t.left+window.scrollX,r=t.top+window.scrollY,d=t.width,c=t.height,u=n.width,i=n.height;switch(s.position){case"cm":case"mc":e.x=a+(d/2-u/2),e.y=r+(c/2-i/2);break;case"lm":e.x=a-u-b.spacing,e.y=r+(c/2-i/2);break;case"lt":e.x=a-u-b.spacing,e.y=r;break;case"lb":e.x=a-u-b.spacing,e.y=r+c-i;break;case"rm":e.x=a+d+b.spacing,e.y=r+(c/2-i/2);break;case"rt":e.x=a+d+b.spacing,e.y=r;break;case"rb":e.x=a+d+b.spacing,e.y=r+c-i;break;case"bl":e.x=a,e.y=r+c+b.spacing;break;case"bc":e.x=a+(d/2-u/2),e.y=r+c+b.spacing;break;case"br":e.x=a+d-u,e.y=r+c+b.spacing;break;case"tl":e.x=a,e.y=r-i-b.spacing;break;case"tc":e.x=a+(d/2-u/2),e.y=r-i-b.spacing;break;case"tr":e.x=a+d-u,e.y=r-i-b.spacing}return e.x+="px",e.y+="px",e}function l(){s.currentDate&&(d.$setViewValue(s.currentDate.format(b.modelDateFormat)),d.$render(),o.prop("value",s.currentDate.format(b.viewDateFormat)))}function m(e,t){return"string"==typeof e?moment(e,b.modelDateFormat):e?moment(e):t||null}function p(){s.min&&moment.min(s.currentDate,s.min)==s.currentDate&&(s.currentDate=s.min.clone()),s.max&&moment.max(s.currentDate,s.max)==s.currentDate&&(s.currentDate=s.max.clone())}var g,y,b=s.datePicker||s.options||{},v="DATE-PICKER"===o.prop("tagName");b.modelDateFormat=b.modelDateFormat||n.modelDateFormat,b.viewDateFormat=b.viewDateFormat||n.viewDateFormat,b.spacing=b.spacing||n.spacing||0,b.steps=b.steps||n.steps,b.autoIncrement=b.autoIncrement||n.autoIncrement,b.autoIncrementInterval=b.autoIncrementInterval||n.autoIncrementInterval,b.className=b.className||n.className,Object.keys(n.autoIncrement).forEach(function(e){b.autoIncrement[e]=b.autoIncrement[e]||n.autoIncrement[e]}),Object.keys(n.steps).forEach(function(e){b.steps[e]=b.steps[e]||n.steps[e]}),s.isInline=v,s.steps=b.steps,s.position=b.position||n.position,s.min=m(b.min),s.max=m(b.max),s.currentDate=m(s.model,moment()),s.daysNames=[],s.weeks=[],s.showCalendar="boolean"==typeof b.calendar?b.calendar:n.calendar,s.showTime="boolean"==typeof b.time?b.time:n.time,s.showHeader="boolean"==typeof b.header?b.header:n.header,s.showControls="boolean"==typeof b.controls?b.controls:n.controls,s.getDaysNames=function(){s.daysNames=[];for(var e=moment("4/1/1970","D/M/YYYY"),t=0;7>t;t++)s.daysNames.push({name:e.format("dd"),weekend:0==t||6==t}),e.add(1,"days")},s.getDaysNames(),s.getMonthDays=function(){var e,t=moment(s.currentDate).startOf("month"),n=moment(s.currentDate).endOf("month"),a=t.day(),o=n.day(),r=s.currentDate.daysInMonth(),d=[];for(e=0;r>e;e++)d.push({number:e+1,inactive:t.clone().date(e+1).isBefore(s.min)||t.clone().date(e+1).isAfter(s.max),weekend:c(s.currentDate,e+1),today:u(s.currentDate,e+1)});var i=t.subtract(1,"days").date();for(e=0;a>e;e++)d.unshift({number:i,inactive:!0,weekend:c(t,i)}),t.subtract(1,"days"),i--;for(e=o;6>e;e++)n.add(1,"days"),d.push({number:n.date(),inactive:!0,weekend:c(n,n.date())});for(s.weeks.length=0,e=0;e<d.length/7;e++)s.weeks.push(d.slice(7*e,7*(e+1)))},s.open=function(){s.getDaysNames(),s.getMonthDays(),g=angular.element('<div class="ngldp__backdrop"></div>'),y=e(n.template)(s),b.className&&y.addClass(b.className),v||s.$apply(),v||g.on("click",function(){s.close()});var t;v||(t=i(),y.css("left",t.x),y.css("top",t.y)),v?(o.empty(),o.append(y)):(a.append(g),a.append(y)),v||(t=i(),y.css("left",t.x),y.css("top",t.y)),"function"==typeof b.onOpen&&b.onOpen()},v&&s.open(),s.close=function(){!v&&y&&(y&&(y.remove(),y=null),g&&(g.remove(),g=null),"function"==typeof b.onClose&&b.onClose())},p(),s.prev=function(e){s.currentDate.subtract(b.steps[e],n.unitsMap[e]),p(),s.getMonthDays(),l()},s.next=function(e){s.currentDate.add(b.steps[e],n.unitsMap[e]),p(),s.getMonthDays(),l()},s.selectDay=function(e){e.inactive||(s.currentDate.date(e.number),p(),l())},s.selectToday=function(){s.currentDate=moment(),p(),s.getMonthDays(),l()},s.add=function(e,t){s.currentDate.add(e,t),p(),s.getMonthDays(),l()},s.subtract=function(e,t){s.currentDate.subtract(e,t),p(),s.getMonthDays(),l()};var _=[];s.startAutoIncrement=function(e){s.endAutoIncrement(),_.push(t(function(){s.add(b.autoIncrement[e],n.unitsMap[e])},b.autoIncrementInterval))},s.startAutoDecrement=function(e){s.endAutoIncrement(),_.push(t(function(){s.subtract(b.autoIncrement[e],n.unitsMap[e])},b.autoIncrementInterval))},s.endAutoIncrement=function(){_.forEach(function(e){t.cancel(e)}),_.length=0},s.isActivateKey=function(e){var t=32===e.which||13===e.which;return t&&e.preventDefault(),t},v||o.on("click",function(){s.open()}),l()}}}]);